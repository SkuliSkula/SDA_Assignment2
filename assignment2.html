<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Assignment 2</title>
    <link rel="stylesheet" href="styles/bootstrap.min.css">
    <link rel="stylesheet" href="styles/bootstrap-theme.min.css">
    <link rel="stylesheet" href="styles/week7ex.css"> </head>

<body>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="scripts/bootstrap.js"></script>
    <script type="text/javascript" src="scripts/d3.js"></script>
    <script type="text/javascript" src="scripts/d3tip.js"></script>
    
    <script type="text/javascript">
        var data2003,data2015, joinedData = [];
        var svg = undefined;
        var margin = {top: 40, right: 20, bottom: 30, left: 30},
            width = 960 - margin.left - margin.right,
            height = 500 - margin.top - margin.bottom;
        var padding = 65;
        var xScale,yScale, rScale, tip;

        // Reading data for 2003 
        d3.csv("/data/distr_prost_vt_count_2003.csv", function(error, data){
            if(error) {
                console.log("Error: ", error);
            } else {
                data.map(function(d) {
                    joinedData.push({"Prostitution": +d.prostitution, "Vehicle_theft": +d.vehicle_theft});
                });
                data2003 = data;
                loadSecondDataSet();
                
            } 
        });
    
    function loadSecondDataSet() {
        
        // Reading the data for visualization 2
        d3.csv("/data/distr_prost_vt_count_2015.csv", function(error, data){
            if(error) {
                console.log("Error: ", error);
            } else {
                data.map(function(d) {
                    joinedData.push({"Prostitution": +d.prostitution, "Vehicle_theft": +d.vehicle_theft});
                });
                data2015 = data;
                initVisualization(data2003, joinedData);
            } 
        });
    }  

    function switchData(data) {
        console.log(data);
        var dataset = []; 
                
        if(data) {
            dataset = data2003; 
        }
        else{
            dataset = data2015; 
        }

        
        svg.selectAll("circle")
            .data(dataset)
            .transition()
            .delay(function(d,i){
            return i / dataset.length * 1000;
            })
            .duration(500)
            .ease("linear")
            .attr("cx", function(d) {
                return xScale(+d.prostitution);
            })
            .attr("cy", function(d) {
                return yScale(+d.vehicle_theft);
            })
            .attr("r", function(d) {
                return rScale((+d.prostitution + +d.vehicle_theft));
            });
           
        // Add Text Labels
        svg.selectAll("text")
            .data(dataset)
            .text(function(d) {
                return d.district;
            })
            .attr("x", function(d) {
                return xScale(+d.prostitution); 
            })
            .attr("y", function(d) {
                return -10 + yScale(+d.vehicle_theft);
            });
            
    }  
        
    function initVisualization(data, joinedData) {

        // Create an array with Count only to get the max for scaling
        var countProstitutionArray = [];
        var countVehicleTheftArray = [];
        
        joinedData.map(function(d) {
            countProstitutionArray.push(parseInt(d.Prostitution));
            countVehicleTheftArray.push(parseInt(d.Vehicle_theft));
        })
        
        // Join the data so we can scale the radius
        var joined = data.map(function(d){
            return (+d.prostitution + +d.vehicle_theft);  
        });

        xScale = d3.scale.linear()
                     .domain([0, d3.max(countProstitutionArray, function(d) { return d; })])
                     .range([padding, width - padding * 2]);
        
        yScale = d3.scale.linear()
                     .domain([0, d3.max(countVehicleTheftArray, function(d) { return d; })])
                     .range([height - padding, padding]);
        
        rScale = d3.scale.linear()
                     .domain([0, d3.max(joined, function(d) { return d; })])
                     .range([2, 10]);
        
        // Create the tooltip
        tip = d3.tip()
            .attr('class', 'd3-tip')
            .offset([-10, 0])
            .html(function(d) {
                return "<strong>"+ d.district + ": " +"</strong> <span style='color:red'>" + "(" + d.prostitution +","+ d.vehicle_theft + ")" + "</span>";
            });
        
        
        // Create the SVG
        svg = d3.select("#visualization1")
            .append("svg")
            .attr("width", width)
            .attr("height", height);
        
        svg.call(tip);
        
        svg.selectAll("#scatter")
            .data(data)
            .enter()
            .append("circle")  
            .attr("class", "circle")
            .attr("cx", function(d) {
                return xScale(+d.prostitution);
            })
            .attr("cy", function(d) {
                return yScale(+d.vehicle_theft);
            })
            .attr("r", function(d) {
                return rScale((+d.prostitution + +d.vehicle_theft));
            })
            .on('mouseover', tip.show)
            .on('mouseout', tip.hide);
    
        // Add Text Labels
        svg.selectAll("text")
            .data(data)
            .enter()
            .append("text")
            .text(function(d) {
                return d.district;
            })
            .attr("x", function(d) {
                return xScale(+d.prostitution); 
            })
            .attr("y", function(d) {
                    return -10 + yScale(+d.vehicle_theft);
            })
            .on("mouseover", tip.show)
            .on("mouseout", tip.hide);

        
        var xAxis = d3.svg.axis()
                  .scale(xScale)
                  .orient("bottom")
                  .ticks(10);
        
        var yAxis = d3.svg.axis()
                  .scale(yScale)
                  .orient("left")
                  .ticks(10);
        
        svg.append("g")
            .attr("class", "axis")
            .attr("transform", "translate(0," + (height-padding) + ")")
            .call(xAxis)
            .append("text")
            .attr("class", "labelaxis")
            .attr("y", 45)
            .attr("x", 360)
            .text("Prostitution");
            
        svg.append("g")
            .attr("class", "axis")
            .attr("transform", "translate(" + padding + ",0)")
            .call(yAxis)
            .append("text")
              .attr("class", "labelaxis")
              .attr("transform", "rotate(-90)")
              .attr("y", 200)
              .attr("x", 20)
              .attr("dy", "-15.5em")
              .attr("dx", "-12em")
              .style("text-anchor", "end")
            .text("Vehicle theft");
    }
            
    </script>
    <div class="container">
        <div class="col-sm-12">
            <h1>Assignment 2A:</h1>
            <h3>Scatterplot of Prostitution and Vehicle Theft</h3>
            <p>Scatterplot showing Prostitution on the x-axis and Vehicle Theft on the y-axis. Click on the buttons to see difference between data from 2003 and 2015</p>
           <div class="btn-group" data-toggle="buttons">
                <label class="btn btn-info active" onclick="switchData(true);">
                    <input type="radio" name="options" id="data2003" autocomplete="off" checked> Data 2003
                </label>
                <label class="btn btn-info" onclick="switchData(false);">
                    <input type="radio" name="options" id="data2015" autocomplete="off"> Data 2015
                </label>
            </div>
            <div id="visualization1" class="scatter">
            </div>
        </div>
    </div>
  </body>

</html>